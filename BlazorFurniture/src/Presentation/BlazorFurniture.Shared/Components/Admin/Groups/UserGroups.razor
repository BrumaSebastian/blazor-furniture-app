@using BlazorFurniture.Shared.Models.Users.Responses
@using BlazorFurniture.Shared.Resources.Pages.Admin
@using BlazorFurniture.Shared.Services.Security.Interfaces
@using Microsoft.Extensions.Localization
@using Microsoft.Extensions.Logging

<ContentWithHeader Title="@AdminResource.myGroups" Class="h-full" Style="@Style">
    <ChildContent>
        <MudList T="GroupPermissions" Dense=true Gutters=true Class="overflow-y-scroll" Style="min-height:300px;">
            @foreach (var group in Groups ?? [])
            {
                <MudDivider DividerType="DividerType.FullWidth" />
                <MudListItem Href="@($"/admin/groups/{group.Id}")">
                    <AvatarContent>
                        <MudAvatar>
                            <MudImage Src="https://picsum.photos/200/300" />
                        </MudAvatar>
                    </AvatarContent>
                    <ChildContent>
                        <MudText Typo="Typo.h6">@group.Name</MudText>
                        <MudText Typo="Typo.subtitle2" Color="Color.Secondary">@CommonResource.role: @CommonLocalizer[$"roles.{group.Role}"]</MudText>
                    </ChildContent>
                </MudListItem>
            }
        </MudList>
    </ChildContent>
</ContentWithHeader>

@code {
    [Inject] public required IStringLocalizer<CommonResource> CommonLocalizer { get; set; }
    //TODO: Create specific get groups for user endpoint
    [Inject] public required IPermissionsService PermissionsService { get; set; }

    [PersistentState]
    public IEnumerable<GroupPermissions>? Groups { get; set; }

    [Parameter]
    public string Style { get; set; } = string.Empty;

    protected override async Task OnInitializedAsync()
    {
        var permissions = await PermissionsService.GetUserPermissions();
        Groups ??= permissions?.Groups ?? [];
    }
}
