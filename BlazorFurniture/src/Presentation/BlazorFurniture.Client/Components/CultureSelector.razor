@using System.Globalization
@inject IJSRuntime JS
@inject NavigationManager Navigation
@using BlazorFurniture.Client.Resources.Common

<MudMenu Color="Color.Primary" AriaLabel="Profile">
	<ActivatorContent>
		<MudIconButton Color="Color.Primary">
			<MudImage Src="@cultureDict[selectedCulture!].flag" Width="32" />
		</MudIconButton>
	</ActivatorContent>
	<ChildContent>
		<MudMenuItem>
			<MudText Align="Align.Center">@CommonResource.message_choose_language</MudText>
		</MudMenuItem>
		<MudSelect Dense=true @bind-Value=selectedCulture Variant="Variant.Filled" @bind-Value:after="OnCultureChanged">
			@foreach ((var culture, var value) in cultureDict)
			{
				<MudSelectItem Value=culture>
					<MudImage src="@value.flag" Width="32" /> @value.name
				</MudSelectItem>
			}
		</MudSelect>
	</ChildContent>
</MudMenu>

@code
{
	private Dictionary<string, (string flag, string name)> cultureDict =
		new()
		{
			{ Cultures.ENGLISH, ("https://upload.wikimedia.org/wikipedia/commons/b/be/Flag_of_England.svg", CulturesResource.en) },
			{ Cultures.ROMANIAN, ("https://upload.wikimedia.org/wikipedia/commons/7/73/Flag_of_Romania.svg", CulturesResource.ro) }
		};

	private string? selectedCulture = CultureInfo.CurrentCulture.Name;

	private async Task OnCultureChanged()
	{
		if (CultureInfo.CurrentCulture.Name != selectedCulture)
		{
			await JS.InvokeVoidAsync("blazorCulture.set", selectedCulture);
			Navigation.NavigateTo(Navigation.Uri, forceLoad: true);
		}
	}
}
