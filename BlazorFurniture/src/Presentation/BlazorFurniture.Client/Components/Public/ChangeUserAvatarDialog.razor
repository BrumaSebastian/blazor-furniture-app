@using System.Text
<MudDialog Gutters="true" TitleClass="mud-width-full" ContentClass="mb-2">
    <TitleContent>
        <MudStack>
            <MudText Typo="Typo.h5"><strong>Choose a Predefined Avatar</strong></MudText>
            <MudText Typo="Typo.caption">Select one of the avatars below for you profile</MudText>
        </MudStack>
        <MudDivider DividerType="DividerType.FullWidth" />
    </TitleContent>
    <DialogContent>
        <MudGrid>
            @for (int i = 0; i < avatars.Length; i++)
            {
                var index = i;
                <MudItem xs="6" sm="4" md="2">
                    <MudImage 
                        Class="@SetSelectedAvatarClass(avatars[index])"
                        Height="150" Width="150" Src="@avatars[index]" @onclick="@(() => SelectImage(index))"></MudImage>
                </MudItem>
            }
        </MudGrid>
    </DialogContent>
    <DialogActions>
        <MudButton OnClick="Cancel" FullWidth="true">Cancel</MudButton>
        <MudButton Disabled="@(Avatar == selectedAvatar)" Color="Color.Error" FullWidth="true" Variant="Variant.Filled" OnClick="Confirm">Confirm</MudButton>
    </DialogActions>
</MudDialog>

@code {
    [CascadingParameter] private IMudDialogInstance MudDialog { get; init; } = default!;

    [Parameter] public required string? Avatar { get; init; }

    private readonly string[] avatars = [
        "/media/avatars/bear.png",
        "/media/avatars/cat.png",
        "/media/avatars/gorilla.png",
        "/media/avatars/man.png",
        "/media/avatars/man-2.png",
        "/media/avatars/meerkat.png",
        "/media/avatars/rabbit.png",
        "/media/avatars/woman.png",
        "/media/avatars/woman-2.png"
    ];

    private string? selectedAvatar = default!;

    protected override void OnParametersSet()
    {
        selectedAvatar = Avatar;
    }

    private void Cancel()
    {
        MudDialog.Cancel();
    }

    private void SelectImage(int index)
    {
        selectedAvatar = avatars[index];
    }

    private async Task Confirm()
    {
        MudDialog.Close(selectedAvatar);
    }

    private string SetSelectedAvatarClass(string image)
    {
        StringBuilder stringBuilder = new();

        if (image == selectedAvatar)
        {
            stringBuilder.Append("border-solid border-2 mud-border-primary rounded");
        }

        return stringBuilder.ToString();
    }
}