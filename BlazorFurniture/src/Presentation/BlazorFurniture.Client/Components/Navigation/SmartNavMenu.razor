@using BlazorFurniture.Shared.Models.Users
@using BlazorFurniture.Shared.Services.Security.Interfaces
@inject IPermissionsService PermissionsService

<!-- Public Links (always visible) -->
<MudNavLink Href="/" Icon="@Icons.Material.Filled.Home">Home</MudNavLink>
<MudNavLink Href="/shop" Icon="@Icons.Material.Filled.Store">Shop</MudNavLink>

<AuthorizeView>
    <Authorized>
        <!-- User Links (authenticated users) -->
        <MudDivider Class="my-2" />
        <MudNavLink Href="/account/orders" Icon="@Icons.Material.Filled.ShoppingBag">
            My Orders
        </MudNavLink>
        <MudNavLink Href="/account/wishlist" Icon="@Icons.Material.Filled.Favorite">
            Wishlist
        </MudNavLink>

        <!-- Admin Links (conditionally shown) -->
        @if (canAccessAdmin)
        {
            <MudDivider Class="my-2" />
            <MudNavGroup Title="Admin" Icon="@Icons.Material.Filled.AdminPanelSettings">
                <MudNavLink Href="/admin/dashboard" Icon="@Icons.Material.Filled.Dashboard">
                    Dashboard
                </MudNavLink>
                <MudNavLink Href="/admin/users" Icon="@Icons.Material.Filled.People">
                    Users
                </MudNavLink>
                <MudNavLink Href="/admin/products" Icon="@Icons.Material.Filled.Inventory">
                    Products
                </MudNavLink>
            </MudNavGroup>
        }
    </Authorized>
</AuthorizeView>

@code {
    private bool canAccessAdmin = false;

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            var permissions = await PermissionsService.GetUserPermissions();
            canAccessAdmin = permissions?.Role == PlatformRoles.Admin || 
                           permissions?.Permissions.Contains("view-admin-panel") == true;
            StateHasChanged();
        }
    }
}